// https://crossfilter.github.io/crossfilter/ v1.5.2 Copyright 2020 Mike Bostock
!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(r=r||self).crossfilter=n()}(this,(function(){"use strict";let r=u,n=u,e=u,t=f,o=i;function u(r){for(var n=new Array(r),e=-1;++e<r;)n[e]=0;return n}function f(r,n){for(var e=r.length;e<n;)r[e++]=0;return r}function i(r,n){if(n>32)throw new Error("invalid array width!");return r}function a(n){this.length=n,this.subarrays=1,this.width=8,this.masks={0:0},this[0]=r(n)}"undefined"!=typeof Uint8Array&&(r=function(r){return new Uint8Array(r)},n=function(r){return new Uint16Array(r)},e=function(r){return new Uint32Array(r)},t=function(r,n){if(r.length>=n)return r;var e=new r.constructor(n);return e.set(r),e},o=function(r,t){var o;switch(t){case 16:o=n(r.length);break;case 32:o=e(r.length);break;default:throw new Error("invalid array width!")}return o.set(r),o}),a.prototype.lengthen=function(r){var n,e;for(n=0,e=this.subarrays;n<e;++n)this[n]=t(this[n],r);this.length=r},a.prototype.add=function(){var n,e,t,u,f;for(u=0,f=this.subarrays;u<f;++u)if(t=(~(n=this.masks[u])&n+1)>>>0,!((e=this.width-32*u)>=32)||t)return e<32&&t&1<<e&&(this[u]=o(this[u],e<<=1),this.width=32*u+e),this.masks[u]|=t,{offset:u,one:t};return this[this.subarrays]=r(this.length),this.masks[this.subarrays]=1,this.width+=8,{offset:this.subarrays++,one:1}},a.prototype.copy=function(r,n){var e,t;for(e=0,t=this.subarrays;e<t;++e)this[e][r]=this[e][n]},a.prototype.truncate=function(r){var n,e;for(n=0,e=this.subarrays;n<e;++n)for(var t=this.length-1;t>=r;t--)this[n][t]=0;this.length=r},a.prototype.zero=function(r){var n,e;for(n=0,e=this.subarrays;n<e;++n)if(this[n][r])return!1;return!0},a.prototype.zeroExcept=function(r,n,e){var t,o;for(t=0,o=this.subarrays;t<o;++t)if(t===n?this[t][r]&e:this[t][r])return!1;return!0},a.prototype.zeroExceptMask=function(r,n){var e,t;for(e=0,t=this.subarrays;e<t;++e)if(this[e][r]&n[e])return!1;return!0},a.prototype.only=function(r,n,e){var t,o;for(t=0,o=this.subarrays;t<o;++t)if(this[t][r]!=(t===n?e:0))return!1;return!0},a.prototype.onlyExcept=function(r,n,e,t,o){var u,f,i;for(f=0,i=this.subarrays;f<i;++f)if(u=this[f][r],f===n&&(u&=e),u!=(f===t?o:0))return!1;return!0};var l={array8:u,array16:u,array32:u,arrayLengthen:f,arrayWiden:i,bitarray:a};var s=(r,n)=>function(e){var t=e.length;return[r.left(e,n,0,t),r.right(e,n,0,t)]},h=(r,n)=>{var e=n[0],t=n[1];return function(n){var o=n.length;return[r.left(n,e,0,o),r.left(n,t,0,o)]}},c=r=>[0,r.length],v=r=>r,p=()=>null,g=()=>0;function y(r){function n(r,n,t){for(var o=t-n,u=1+(o>>>1);--u>0;)e(r,u,o,n);return r}function e(n,e,t,o){for(var u,f=n[--o+e],i=r(f);(u=e<<1)<=t&&(u<t&&r(n[o+u])>r(n[o+u+1])&&u++,!(i<=r(n[o+u])));)n[o+e]=n[o+u],e=u;n[o+e]=f}return n.sort=function(r,n,t){for(var o,u=t-n;--u>0;)o=r[n],r[n]=r[n+u],r[n+u]=o,e(r,1,u,n);return r},n}const d=y(v);function x(r){var n=d.by(r);return function(e,t,o,u){var f,i,a,l=new Array(u=Math.min(o-t,u));for(i=0;i<u;++i)l[i]=e[t++];if(n(l,0,u),t<o){f=r(l[0]);do{r(a=e[t])>f&&(l[0]=a,f=r(n(l,0,u)[0]))}while(++t<o)}return l}}d.by=y;const b=x(v);function m(r){function n(n,e,t,o){for(;t<o;){var u=t+o>>>1;e<r(n[u])?o=u:t=u+1}return t}return n.right=n,n.left=function(n,e,t,o){for(;t<o;){var u=t+o>>>1;r(n[u])<e?t=u+1:o=u}return t},n}b.by=x;const w=m(v);w.by=m;var E=(r,n,e)=>{for(var t=0,o=n.length,u=e?JSON.parse(JSON.stringify(r)):new Array(o);t<o;++t)u[t]=r[n[t]];return u};var z=r=>r+1,A=r=>r-1,k=r=>function(n,e){return n+ +r(e)},O=r=>function(n,e){return n-r(e)};const M=(r,n)=>{const e=r[n];return"function"==typeof e?e.call(r):e},C=/\[([\w\d]+)\]/g;var F=(r,n)=>function(r,n,e,t,o){for(o in t=(e=e.split(".")).splice(-1,1),e)n=n[e[o]]=n[e[o]]||{};return r(n,t)}(M,r,n.replace(C,".$1"));function N(){var r,n={add:a,remove:y,dimension:M,groupAll:C,size:N,all:W,allFiltered:J,onChange:R,isElementFiltered:m},e=[],t=0,o=[],u=[],f=[],i=[];function a(o){var f=t,i=o.length;return i&&(e=e.concat(o),r.lengthen(t+=i),u.forEach((function(r){r(o,f,i)})),j("dataAdded")),n}function y(n){for(var u,i=new Array(t),a=[],l="function"==typeof n,s=0,h=0;s<t;++s)u=s,(l?n(e[u],u):r.zero(u))?(a.push(s),i[s]=-1):i[s]=h++;o.forEach((function(r){r(-1,-1,[],a,!0)})),f.forEach((function(r){r(i)}));for(var c=0,v=0;c<t;++c)-1!==i[c]&&(c!==v&&(r.copy(v,c),e[v]=e[c]),++v);e.length=t=v,r.truncate(v),j("dataRemoved")}function x(n){var e,t,o,u,f=Array(r.subarrays);for(e=0;e<r.subarrays;e++)f[e]=-1;for(t=0,o=n.length;t<o;t++)f[(u=n[t].id())>>7]&=~(1<<(63&u));return f}function m(n,e){var t=x(e||[]);return r.zeroExceptMask(n,t)}function M(n,i){if("string"==typeof n){var a=n;n=function(r){return F(r,a)}}var y,x,m,M,C,N,W,J,R,$,q,B,D,G,H={filter:function(r){return null==r?ur():Array.isArray(r)?or(r):"function"==typeof r?fr(r):tr(r)},filterExact:tr,filterRange:or,filterFunction:fr,filterAll:ur,currentFilter:function(){return B},hasCurrentFilter:function(){return D},top:function(n,t){var o,u=[],f=X,a=0;t&&t>0&&(a=t);for(;--f>=V&&n>0;)r.zero(o=N[f])&&(a>0?--a:(u.push(e[o]),--n));if(i)for(f=0;f<I.length&&n>0;f++)r.zero(o=I[f])&&(a>0?--a:(u.push(e[o]),--n));return u},bottom:function(n,t){var o,u,f=[],a=0;t&&t>0&&(a=t);if(i)for(o=0;o<I.length&&n>0;o++)r.zero(u=I[o])&&(a>0?--a:(f.push(e[u]),--n));o=V;for(;o<X&&n>0;)r.zero(u=N[o])&&(a>0?--a:(f.push(e[u]),--n)),o++;return f},group:ar,groupAll:function(){var r=ar(p),n=r.all;return delete r.all,delete r.top,delete r.order,delete r.orderNatural,delete r.size,r.value=function(){return n()[0].value},r},dispose:lr,remove:lr,accessor:n,id:function(){return M}},I=[],K=function(r){return U(r).sort((function(r,n){var e=W[r],t=W[n];return e<t?-1:e>t?1:r-n}))},P=c,Q=[],T=[],V=0,X=0,Y=0;u.unshift(_),u.push(rr),f.push(nr);var Z=r.add();function _(e,o,u){var f,a;if(i){Y=0,j=0,G=[];for(var s=0;s<e.length;s++)for(j=0,G=n(e[s]);j<G.length;j++)Y++;W=[],f=U(e.length),a=S(Y,1);for(var h=U(Y),c=0,v=0;v<e.length;v++)if((G=n(e[v])).length)for(f[v]=G.length,j=0;j<G.length;j++)W.push(G[j]),h[c]=v,c++;else f[v]=0,I.push(v+o);var p=K(Y);W=E(W,p),J=E(h,p)}else W=e.map(n),J=K(u),W=E(W,J);var g,d,x,b=P(W),w=b[0],z=b[1];if(i)if(u=Y,q)for(g=0;g<u;++g)q(W[g],g)||(0==--f[J[g]]&&(r[m][J[g]+o]|=y),a[g]=1);else{for(d=0;d<w;++d)0==--f[J[d]]&&(r[m][J[d]+o]|=y),a[d]=1;for(x=z;x<u;++x)0==--f[J[x]]&&(r[m][J[x]+o]|=y),a[x]=1}else if(q)for(g=0;g<u;++g)q(W[g],g)||(r[m][J[g]+o]|=y);else{for(d=0;d<w;++d)r[m][J[d]+o]|=y;for(x=z;x<u;++x)r[m][J[x]+o]|=y}if(!o)return C=W,N=J,R=f,$=a,V=w,void(X=z);var A,k=C,O=N,M=$,F=0;if(s=0,i&&(A=o,o=k.length,u=Y),C=new Array(i?o+u:t),N=i?new Array(o+u):S(t,t),i&&($=S(o+u,1)),i){var L=R.length;R=l.arrayLengthen(R,t);for(var j=0;j+L<t;j++)R[j+L]=f[j]}for(var B=0;s<o&&F<u;++B)k[s]<W[F]?(C[B]=k[s],i&&($[B]=M[s]),N[B]=O[s++]):(C[B]=W[F],i&&($[B]=a[F]),N[B]=J[F++]+(i?A:o));for(;s<o;++s,++B)C[B]=k[s],i&&($[B]=M[s]),N[B]=O[s];for(;F<u;++F,++B)C[B]=W[F],i&&($[B]=a[F]),N[B]=J[F]+(i?A:o);b=P(C),V=b[0],X=b[1]}function rr(r,n,e){Q.forEach((function(r){r(W,J,n,e)})),W=J=null}function nr(r){if(i){for(var n=0,e=0;n<I.length;n++)-1!==r[I[n]]&&(I[e]=r[I[n]],e++);for(I.length=e,n=0,e=0;n<t;n++)-1!==r[n]&&(e!==n&&(R[e]=R[n]),e++);R=R.slice(0,e)}for(var o,u=C.length,f=0,a=0;f<u;++f)-1!==r[o=N[f]]&&(f!==a&&(C[a]=C[f]),N[a]=r[o],i&&($[a]=$[f]),++a);for(C.length=a,i&&($=$.slice(0,a));a<u;)N[a++]=0;var l=P(C);V=l[0],X=l[1]}function er(n){var e=n[0],t=n[1];if(q)return q=null,ir((function(r,n){return e<=n&&n<t}),0===n[0]&&n[1]===C.length),V=e,X=t,H;var u,f,a,l=[],s=[],h=[],v=[];if(e<V)for(u=e,f=Math.min(V,t);u<f;++u)l.push(N[u]),h.push(u);else if(e>V)for(u=V,f=Math.min(e,X);u<f;++u)s.push(N[u]),v.push(u);if(t>X)for(u=Math.max(e,X),f=t;u<f;++u)l.push(N[u]),h.push(u);else if(t<X)for(u=Math.max(V,t),f=X;u<f;++u)s.push(N[u]),v.push(u);if(i){var p=[],g=[];for(u=0;u<l.length;u++)R[l[u]]++,$[h[u]]=0,1===R[l[u]]&&(r[m][l[u]]^=y,p.push(l[u]));for(u=0;u<s.length;u++)R[s[u]]--,$[v[u]]=1,0===R[s[u]]&&(r[m][s[u]]^=y,g.push(s[u]));if(l=p,s=g,P===c)for(u=0;u<I.length;u++)r[m][a=I[u]]&y&&(r[m][a]^=y,l.push(a));else for(u=0;u<I.length;u++)r[m][a=I[u]]&y||(r[m][a]^=y,s.push(a))}else{for(u=0;u<l.length;u++)r[m][l[u]]^=y;for(u=0;u<s.length;u++)r[m][s[u]]^=y}return V=e,X=t,o.forEach((function(r){r(y,m,l,s)})),j("filtered"),H}function tr(r){return B=r,D=!0,er((P=s(w,r))(C))}function or(r){return B=r,D=!0,er((P=h(w,r))(C))}function ur(){return B=void 0,D=!1,er((P=c)(C))}function fr(r){B=r,D=!0,q=r,P=c,ir(r,!1);var n=P(C);return V=n[0],X=n[1],H}function ir(n,e){var t,u,f,a=[],l=[],s=[],h=[],c=C.length;if(!i)for(t=0;t<c;++t)!(r[m][u=N[t]]&y)^!!(f=n(C[t],t))&&(f?a.push(u):l.push(u));if(i)for(t=0;t<c;++t)n(C[t],t)?(a.push(N[t]),s.push(t)):(l.push(N[t]),h.push(t));if(i){var v=[],p=[];for(t=0;t<a.length;t++)1===$[s[t]]&&(R[a[t]]++,$[s[t]]=0,1===R[a[t]]&&(r[m][a[t]]^=y,v.push(a[t])));for(t=0;t<l.length;t++)0===$[h[t]]&&(R[l[t]]--,$[h[t]]=1,0===R[l[t]]&&(r[m][l[t]]^=y,p.push(l[t])));if(a=v,l=p,e)for(t=0;t<I.length;t++)r[m][u=I[t]]&y&&(r[m][u]^=y,a.push(u));else for(t=0;t<I.length;t++)r[m][u=I[t]]&y||(r[m][u]^=y,l.push(u))}else{for(t=0;t<a.length;t++)r[m][a[t]]&y&&(r[m][a[t]]&=x);for(t=0;t<l.length;t++)r[m][l[t]]&y||(r[m][l[t]]|=y)}o.forEach((function(r){r(y,m,a,l)})),j("filtered")}function ar(n){var u={top:V,all:P,reduce:X,reduceCount:Y,reduceSum:Z,order:_,orderNatural:rr,size:nr,dispose:er,remove:er};T.push(u);var a,s,h,c,w,E,M,F,U=8,W=L(U),J=0,R=p,j=p,$=!0,q=n===p;function B(u,f,h,c){i&&(F=h,h=C.length-u.length,c=u.length);var v,g,y,d,b,z,A=a,k=i?[]:S(J,W),O=w,N=E,B=M,D=J,P=0,Q=0;for($&&(O=B=p),$&&(N=B=p),a=new Array(J),J=0,s=i?D?s:[]:D>1?l.arrayLengthen(s,t):S(t,W),D&&(y=(g=A[0]).key);Q<c&&!((d=n(u[Q]))>=d);)++Q;for(;Q<c;){for(g&&y<=d?(b=g,z=y,k[P]=J,(g=A[++P])&&(y=g.key)):(b={key:d,value:B()},z=d),a[J]=b;d<=z&&(v=f[Q]+(i?F:h),i?s[v]?s[v].push(J):s[v]=[J]:s[v]=J,b.value=O(b.value,e[v],!0),r.zeroExcept(v,m,x)||(b.value=N(b.value,e[v],!1)),!(++Q>=c));)d=n(u[Q]);V()}for(;P<D;)a[k[P]=J]=A[P++],V();if(i)for(var T=0;T<t;T++)s[T]||(s[T]=[]);if(J>P)if(i)for(P=0;P<F;++P)for(T=0;T<s[P].length;T++)s[P][T]=k[s[P][T]];else for(P=0;P<h;++P)s[P]=k[s[P]];function V(){i?J++:++J===W&&(k=l.arrayWiden(k,U<<=1),s=l.arrayWiden(s,U),W=L(U))}v=o.indexOf(R),J>1||i?(R=G,j=I):(!J&&q&&(J=1,a=[{key:null,value:B()}]),1===J?(R=H,j=K):(R=p,j=p),s=null),o[v]=R}function D(r){if(J>1||i){var n,e,u,f=J,l=a,h=S(f,f);if(i){for(n=0,u=0;n<t;++n)if(-1!==r[n]){for(s[u]=s[n],e=0;e<s[u].length;e++)h[s[u][e]]=1;++u}s=s.slice(0,u)}else for(n=0,u=0;n<t;++n)-1!==r[n]&&(h[s[u]=s[n]]=1,++u);for(a=[],J=0,n=0;n<f;++n)h[n]&&(h[n]=J++,a.push(l[n]));if(J>1||i)if(i)for(n=0;n<u;++n)for(e=0;e<s[n].length;++e)s[n][e]=h[s[n][e]];else for(n=0;n<u;++n)s[n]=h[s[n]];else s=null;o[o.indexOf(R)]=J>1||i?(j=I,R=G):1===J?(j=K,R=H):j=R=p}else if(1===J){if(q)return;for(var c=0;c<t;++c)if(-1!==r[c])return;a=[],J=0,o[o.indexOf(R)]=R=j=p}}function G(n,t,o,u,f){var l,h,c,v,p;if(!(n===y&&t===m||$))if(i){for(l=0,v=o.length;l<v;++l)if(r.zeroExcept(c=o[l],m,x))for(h=0;h<s[c].length;h++)(p=a[s[c][h]]).value=w(p.value,e[c],!1,h);for(l=0,v=u.length;l<v;++l)if(r.onlyExcept(c=u[l],m,x,t,n))for(h=0;h<s[c].length;h++)(p=a[s[c][h]]).value=E(p.value,e[c],f,h)}else{for(l=0,v=o.length;l<v;++l)r.zeroExcept(c=o[l],m,x)&&((p=a[s[c]]).value=w(p.value,e[c],!1));for(l=0,v=u.length;l<v;++l)r.onlyExcept(c=u[l],m,x,t,n)&&((p=a[s[c]]).value=E(p.value,e[c],f))}}function H(n,t,o,u,f){if(!(n===y&&t===m||$)){var i,l,s,h=a[0];for(i=0,s=o.length;i<s;++i)r.zeroExcept(l=o[i],m,x)&&(h.value=w(h.value,e[l],!1));for(i=0,s=u.length;i<s;++i)r.onlyExcept(l=u[i],m,x,t,n)&&(h.value=E(h.value,e[l],f))}}function I(){var n,o,u;for(n=0;n<J;++n)a[n].value=M();if(i){for(n=0;n<t;++n)for(o=0;o<s[n].length;o++)(u=a[s[n][o]]).value=w(u.value,e[n],!0,o);for(n=0;n<t;++n)if(!r.zeroExcept(n,m,x))for(o=0;o<s[n].length;o++)(u=a[s[n][o]]).value=E(u.value,e[n],!1,o)}else{for(n=0;n<t;++n)(u=a[s[n]]).value=w(u.value,e[n],!0);for(n=0;n<t;++n)r.zeroExcept(n,m,x)||((u=a[s[n]]).value=E(u.value,e[n],!1))}}function K(){var n,o=a[0];for(o.value=M(),n=0;n<t;++n)o.value=w(o.value,e[n],!0);for(n=0;n<t;++n)r.zeroExcept(n,m,x)||(o.value=E(o.value,e[n],!1))}function P(){return $&&(j(),$=!1),a}function V(r){var n=h(P(),0,a.length,r);return c.sort(n,0,n.length)}function X(r,n,e){return w=r,E=n,M=e,$=!0,u}function Y(){return X(z,A,g)}function Z(r){return X(k(r),O(r),g)}function _(r){function n(n){return r(n.value)}return h=b.by(n),c=d.by(n),u}function rr(){return _(v)}function nr(){return J}function er(){var r=o.indexOf(R);return r>=0&&o.splice(r,1),(r=Q.indexOf(B))>=0&&Q.splice(r,1),(r=f.indexOf(D))>=0&&f.splice(r,1),(r=T.indexOf(u))>=0&&T.splice(r,1),u}return arguments.length<1&&(n=v),o.push(R),Q.push(B),f.push(D),B(C,N,0,t),Y().orderNatural()}function lr(){T.forEach((function(r){r.dispose()}));var n=u.indexOf(_);return n>=0&&u.splice(n,1),(n=u.indexOf(rr))>=0&&u.splice(n,1),(n=f.indexOf(nr))>=0&&f.splice(n,1),r.masks[m]&=x,ur()}return m=Z.offset,y=Z.one,x=~y,M=m<<7|Math.log(y)/Math.log(2),_(e,0,t),rr(e,0,t),H}function C(){var n,f,i,a,l={reduce:v,reduceCount:p,reduceSum:function(r){return v(k(r),O(r),g)},value:function(){s&&(function(){var o;for(n=a(),o=0;o<t;++o)n=f(n,e[o],!0),r.zero(o)||(n=i(n,e[o],!1))}(),s=!1);return n},dispose:y,remove:y},s=!0;function h(o,u){var a;if(!s)for(a=u;a<t;++a)n=f(n,e[a],!0),r.zero(a)||(n=i(n,e[a],!1))}function c(t,o,u,a,l){var h,c,v;if(!s){for(h=0,v=u.length;h<v;++h)r.zero(c=u[h])&&(n=f(n,e[c],l));for(h=0,v=a.length;h<v;++h)r.only(c=a[h],o,t)&&(n=i(n,e[c],l))}}function v(r,n,e){return f=r,i=n,a=e,s=!0,l}function p(){return v(z,A,g)}function y(){var r=o.indexOf(c);return r>=0&&o.splice(r,1),(r=u.indexOf(h))>=0&&u.splice(r,1),l}return o.push(c),u.push(h),h(e,0),p()}function N(){return t}function W(){return e}function J(n){var o=[],u=0,f=x(n||[]);for(u=0;u<t;u++)r.zeroExceptMask(u,f)&&o.push(e[u]);return o}function R(r){if("function"==typeof r)return i.push(r),function(){i.splice(i.indexOf(r),1)};console.warn("onChange callback parameter must be a function!")}function j(r){for(var n=0;n<i.length;n++)i[n](r)}return r=new l.bitarray(0),arguments.length?a(arguments[0]):n}function S(r,n){return(n<257?l.array8:n<65537?l.array16:l.array32)(r)}function U(r){for(var n=S(r,r),e=-1;++e<r;)n[e]=e;return n}function L(r){return 8===r?256:16===r?65536:4294967296}N.heap=d,N.heapselect=b,N.bisect=w,N.permute=E;return N.version="1.5.2",N}));
